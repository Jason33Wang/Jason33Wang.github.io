<!DOCTYPE html>
<html lang="zh-Hans">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="花些无聊的时间；做点有趣的事">
  <meta name="author" content="Jason">
  <meta name="keywords" content="I came,I saw,I conquered.">
  <title>Django笔记4 - Jason&#39;s修禅房</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<!-- 主题依赖的图标库，不要自行修改 -->
<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_9n5xqdrq0nc.css">


  <link  rel="stylesheet" href="/lib/prettify/github-v2.min.css" />




<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


<link rel="alternate" href="/atom.xml" title="Jason's修禅房" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Jason's修禅房</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">
              <i class="iconfont icon-home-fill"></i>
              Home</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">
              <i class="iconfont icon-archive-fill"></i>
              Archives</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">
              <i class="iconfont icon-category-fill"></i>
              Categories</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">
              <i class="iconfont icon-tags-fill"></i>
              Tags</a>
          </li>
        
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">
              <i class="iconfont icon-user-fill"></i>
              About</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/bg0.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <div class="mt-3 post-meta">
                  <i class="iconfont icon-date-fill" aria-hidden="true"></i>
                  <time datetime="2020-02-05 16:26">
                    Wednesday, February 5th 2020, 4:26 pm
                  </time>
                </div>
              

              <div class="mt-1">
                
                  
                  <span class="post-meta mr-2">
                    <i class="iconfont icon-chart"></i>
                    1.9k 字
                  </span>
                

                
                  
                  <span class="post-meta mr-2">
                      <i class="iconfont icon-clock-fill"></i>
                    
                    
                    24
                     分钟
                  </span>
                

                
              </div>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1><span id="day3-视图">day3 视图</span></h1><h2><span id="概述">概述</span></h2><blockquote>
<ul>
<li><p>作用：视图接受web请求，并响应web请求</p>
</li>
<li><p>本质：视图就是一个python函数</p>
</li>
<li><p>响应：</p>
</li>
<li><p>网页</p>
<ul>
<li>重定向</li>
<li>错误视图</li>
</ul>
</li>
<li><p>json数据</p>
</li>
<li><p>过程</p>
</li>
</ul>
<p><img src="/img/django笔记4/image-20200129123737853.png" srcset="/img/loading.gif" alt="image-20200129123737853"></p>
</blockquote>
<h2><span id="url配置">url配置</span></h2><p>配置流程</p>
<ul>
<li><p>设置根级url配置文件</p>
<ul>
<li>设置<code>setting.py</code>文件中的<code>ROOT_URLCONF</code></li>
<li><code>ROOT_URLCONF=Progject.urls</code></li>
<li>默认实现了</li>
</ul>
</li>
<li><p>urlpatterns</p>
<ul>
<li>一个url实例的列表 </li>
<li>一个url对象包括：<ul>
<li>正则表达式</li>
<li>视图名称</li>
<li>名称</li>
</ul>
</li>
</ul>
</li>
<li><p>url匹配正则的注意事项</p>
<ul>
<li>如果想要从url中获得一个值，需要对正则加小括号</li>
<li>匹配正则前方不需要加反斜杠</li>
<li>正则前需要加<code>r</code>表示字符串不转义</li>
</ul>
</li>
<li><p>引入其他url配置</p>
<ul>
<li>在应用中创建<code>urls.py</code>文件，定义本应用的url配置，在工程<code>urls.py</code>文件中使用<code>include()</code>管理项目的urls文件。这样可以方便管理该项目下不同应用之间的url管理。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 在project/urls.py 文件中</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url<span class="token punctuation">,</span>include
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'myApp.urls'</span><span class="token punctuation">,</span>namespace<span class="token operator">=</span><span class="token string">'myApp'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 在myApp/urls.py文件中添加</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views
urlpatterns<span class="token operator">=</span><span class="token punctuation">[</span>
    url<span class="token punctuation">(</span>r<span class="token string">'^$'</span><span class="token punctuation">,</span>views<span class="token punctuation">.</span>index，name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>url的反向解析</p>
<ul>
<li>概述：如果在视图、模板中使用了硬编码链接，在url配置发生改变时，相应的url路径都需要进行修改</li>
<li>解决：在使用链接时，通过url配置的名称，动态生成url地址</li>
<li>常使用与url模板</li>
</ul>
</li>
</ul>
<h2><span id="视图函数">视图函数</span></h2><ul>
<li><p>定义视图</p>
<ul>
<li>本质：一个函数</li>
<li>视图参数：<ul>
<li>1、<code>request</code> 一个<code>HttpRequest</code>的实例 </li>
<li>2、通过正则表达式获取的参数</li>
<li>位置：一般在<code>viwes.py</code>文件中定义（官方不建议在其他文件中定义）</li>
</ul>
</li>
</ul>
</li>
<li><p>错误视图</p>
<p><code>404</code>视图：<code>url</code>匹配不成功时返回该错误</p>
<ul>
<li>可以在<code>templates</code>目录下定义<code>404.html</code></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>404 error<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>找不到对应的页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>{{request_path}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>request_path</code>：导致错误的网址</li>
<li>配置<code>setting.py</code>文件</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">DEBUG <span class="token operator">=</span> <span class="token boolean">False</span> <span class="token comment" spellcheck="true">#等于True，永远都不会调用404界面</span>
ALLOWED_HOSTS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'*'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#允许任何用户访问</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><code>500</code>视图：在视图代码中出现错误（服务器内部错误）</li>
<li><code>400</code>视图：错误出现于客户操作错误</li>
</ul>
<h2><span id="httprequest对象">HttpRequest对象</span></h2><p><strong>概述：</strong></p>
<ul>
<li>服务器接收http请求后，会根据报文创建<code>HttpRequest</code>对象</li>
<li>视图的第一个参数就是<code>HttpRequest</code>对象</li>
<li>django创建的，之后调用视图时传递给视图</li>
</ul>
<p><strong>属性</strong></p>
<ul>
<li><code>path</code>：请求的完整路径（不包括域名和端口）</li>
<li><code>method</code>：表示请求的额方式，常用的有<code>GET</code>、<code>POST</code></li>
<li><p><code>encoding</code>：表示浏览器提交的数据编码方式，一般为<code>utf-8</code></p>
</li>
<li><p><code>GET</code>：类似字典的对象，包含打了<code>get</code>请求的所有参数</p>
</li>
<li><p><code>Post</code>：类似字典的对象，包含打了<code>post</code>请求的所有参数</p>
</li>
<li><code>FILES</code> ：类似字典的对象，包含了所有的上传的文件</li>
<li><code>COOKIES</code>：字典，包含所有的cookie</li>
<li><code>session</code>：类似字典的对象，表示当前会话</li>
</ul>
<p><strong>方法</strong></p>
<ul>
<li><code>is_ajax()</code>:如果是通过XMLHttpRequest发起的，返回True</li>
</ul>
<p><strong>QueryDict对象</strong></p>
<ul>
<li>request对象中的GET、POST都属于QueryDict对象</li>
<li>方法：<ul>
<li><code>get()</code>：根据<code>key</code>值获取<code>value</code>值</li>
<li><code>getlist</code>：将键的值以列表的形式返回</li>
</ul>
</li>
</ul>
<p><strong>GET属性</strong></p>
<p>获取浏览器传递过来给服务器的数据</p>
<pre class="line-numbers language-html"><code class="language-html">  http://127.0.0.1:8000/get1?a=1&amp;b=2&amp;c=3
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">  <span class="token keyword">def</span> <span class="token function">get1</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
      a<span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
      b<span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
      c<span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>b<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-html"><code class="language-html">  http://127.0.0.1:8000/get2?a=1&amp;a=2&amp;c=3
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">  <span class="token keyword">def</span> <span class="token function">get2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
      a<span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
      a1 <span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      a2 <span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
      c<span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>a1<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>a2<span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>POST属性</strong></p>
<ul>
<li>使用表单提交post请求</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
    gender <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"gender"</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span>  request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span>
    hobby <span class="token operator">=</span>  request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>getlist<span class="token punctuation">(</span><span class="token string">"hobby"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>gender<span class="token punctuation">,</span>age<span class="token punctuation">,</span>hobby<span class="token punctuation">)</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"注册成功"</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2><span id="httpresponse对象">HttpResponse对象</span></h2><p><strong>概述</strong></p>
<ul>
<li>作用：给浏览器返回数据</li>
<li><code>HttpRequest</code>是有django创建的，<code>HttpResponse</code>对象是由程序员创建的</li>
</ul>
<p><strong>返回数据用法</strong></p>
<ul>
<li><p>不调用模板，直接返回数据</p>
</li>
<li><p>调用模板</p>
<ul>
<li><p>使用<code>render</code>方法</p>
<ul>
<li>原型：<code>render(requesr,templateName,{context})</code></li>
</ul>
</li>
</ul>
</li>
<li><p>作用：结合数据和模板，返回完整的HTML界面</p>
<ul>
<li><p>参数</p>
<ul>
<li><code>request</code>：请求体对象</li>
<li><code>templateName</code>：模板路径</li>
<li><code>context</code>：传递给需要渲染在模板上的数据</li>
</ul>
</li>
<li>实例</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">studentsearch</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#包含条件匹配</span>
    <span class="token comment" spellcheck="true"># studentsList = Students.objects.filter(sname__contains='孙')</span>
    <span class="token comment" spellcheck="true">#起始匹配</span>
    studentsList <span class="token operator">=</span> Students<span class="token punctuation">.</span>stuObj<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>sname__startswith<span class="token operator">=</span><span class="token string">'j'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'myApp/students.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"students"</span><span class="token punctuation">:</span>studentsList<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>属性</strong></p>
<ul>
<li><code>content</code>：表示返回内容</li>
<li><code>charset</code>：返回数据的编码格式</li>
<li><code>status_code</code>:响应状态编码：404,200,304</li>
<li><code>content-type</code>:指定输出的MIME类型</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#查看response内容</span>
<span class="token keyword">def</span> <span class="token function">showresponse</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>charset<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token operator">-</span>type<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>方法</strong></p>
<ul>
<li><code>init</code>：使用页面内容实例化<code>HttpResponse</code>对象</li>
<li><code>write(content)</code>以文件的形式写入</li>
<li><code>flush()</code>:以文件的形式输出缓冲区</li>
<li><code>set_cookie(key,value=&#39;&#39;,max_age=None,exprise=None)</code>设置cookie</li>
<li><code>delete_cookie(key)</code><ul>
<li>删除cookie</li>
<li>注意：如果删除一个不存在的key，就当什么都没有发生</li>
</ul>
</li>
</ul>
<p><strong>子类HttpResponseRedirect</strong></p>
<ul>
<li>功能： 重定向，服务器跳转</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponseRedirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> redirect
<span class="token keyword">def</span> <span class="token function">redirect1</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># return  HttpResponseRedirect('/redirect2')</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/redirect2'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">redirect2</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">'我是重定向得到的视图'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>子类JsonResponse</strong></p>
<ul>
<li>返回json数据，一般用于异步请求</li>
<li><code>__init__(self.data)</code></li>
<li>data是一个字典对象</li>
<li>注意： Content-type类型为application/json</li>
</ul>
<h2><span id="状态保持">状态保持</span></h2><ul>
<li><p>概述</p>
<ul>
<li><p>http协议是无状态的，每次请求都是一次新的请求，不记得以前的请求</p>
</li>
<li><p>客户端与服务器的一次通信就是一次会话</p>
</li>
<li><p>实现状态的保持，在客户端或者服务端存储相关会话的数据</p>
</li>
<li><p>存储方式</p>
<ul>
<li><code>Cookie</code>：所有的数据存储在客户端，不要存敏感的数据</li>
<li><code>session</code>：所有的数据存储在服务端，在客户端用<code>Cookie</code>存储<code>session_id</code></li>
<li>在一段时间内跟踪请求者的状态，可以实现跨页面访问当前的请求者的数据</li>
<li>注意：不同的请求者之间不会共享这个数据，与请求者一一对应</li>
</ul>
</li>
<li><p>启用<code>session</code></p>
<ul>
<li>在<code>settings.py</code>文件中</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># INSTALLED_APPS选项</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'django.contrib.sessions'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># IDDLEWARE选项</span>
MIDDLEWARE <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'django.contrib.sessions.middleware.SessionMiddleware'</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>使用<code>session</code></p>
<ul>
<li>启用<code>session</code>后，每个<code>HttpRequest</code>对象都有一个<code>session</code>属性，就是一个类似字典的对象</li>
<li><code>get(key,default=None)</code>:根据键获取<code>session</code>值</li>
<li><code>clear()</code>:清空所有的会话</li>
<li><code>flush()</code>:删除当前的会话并删除会话的<code>Cookie</code></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username<span class="token operator">=</span>request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">"游客"</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># print(username)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'myApp/main.html'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span>username<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'myApp/login.html'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">showmain</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 存储session</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span>username
    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>session<span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/main'</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth <span class="token keyword">import</span> logout
<span class="token keyword">def</span> <span class="token function">quit</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># request.session.clear()</span>
    <span class="token comment" spellcheck="true"># request.session.flush()</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/main'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>设置<code>session</code>过期时间</p>
<ul>
<li><code>set_expiry(value)</code></li>
<li>如果不设置两个星期后过期</li>
<li><code>value</code>为整数（表示多少秒后过期）</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>value</code>可以是一个时间对象</li>
<li><code>value=0</code>关闭浏览器时失效</li>
<li><code>value=None</code>永不过期</li>
</ul>
</li>
<li><p>存储session的位置</p>
<ul>
<li>数据库：默认存储数据库中<code>django.contrib.sessions.backends.db</code></li>
<li>缓存：只存储在本地内存中，如果丢失不能找回，比数据库快<code>django.contrib.sessions.backends.cache</code></li>
<li>同时缓存和数据库，优先从本地缓存中读取，读取不到再去数据库中获取：<code>django.contrib.sessions.backends.cache_db</code></li>
</ul>
</li>
<li><p>使用<code>redis</code>缓存<code>session</code></p>
<ul>
<li>首先要安装redis并开启redis服务</li>
<li><code>pip install django-redis-sessions</code></li>
</ul>
</li>
</ul>
<p><code>`</code>python<br>SESSION_ENGINE=’redis_sessions.session’<br>SESSION_REDIS_HOST=’local_host’<br>SESSION_REDIS_PORT=6379<br>SESSION_REDIS_DB=0<br>SESSION_REDIS_PASSWORD=’qq123’<br>SESSION_REDIS_PREFIX=’session’</p>
</li>
</ul>
<p>  #或者<br>     SESSION_ENGINE = ‘redis_sessions.session’<br>     SESSION_REDIS = {<br>         ‘host’: ‘localhost’,<br>         ‘port’: 6379,<br>         ‘db’: 0,<br>         ‘password’: ‘password’,<br>         ‘prefix’: ‘session’,<br>         ‘socket_timeout’: 1<br>     }<br>  <code>`</code></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/好记性不如烂笔头/">好记性不如烂笔头</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Django/">Django</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" rel="nofollow noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/02/05/django笔记5/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Django笔记5</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/02/02/Django笔记3/">
                        <span class="hidden-mobile">Django笔记3</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<div id="hitokoto" style="text-align:center">D 获取中...</div>
<script>
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      const hitokoto = document.getElementById('hitokoto')
      hitokoto.innerText = data.hitokoto
      })
      .catch(console.error)
</script>
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>






<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').each(function () {
        const pre = $(this);
        if (pre.find('code.mermaid').length > 0) {
          return;
        }
        pre.addClass('prettyprint  linenums');
      });
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Django笔记4&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script type="text/javascript">
      //定义获取词语下标
      var a_idx = 0;
      jQuery(document).ready(function ($) {
        //点击body时触发事件
        $("body").click(function (e) {
          //需要显示的词语
          var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正", "法治", "爱国", "敬业", "诚信", "友善");
          //设置词语给span标签
          var $i = $("<span/>").text(a[a_idx]);
          //下标等于原来下标+1  余 词语总数
          a_idx = (a_idx + 1) % a.length;
          //获取鼠标指针的位置，分别相对于文档的左和右边缘。
          //获取x和y的指针坐标
          var x = e.pageX, y = e.pageY;
          //在鼠标的指针的位置给$i定义的span标签添加css样式
          $i.css({
            "z-index": 999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": rand_color()
          });
          // 随机颜色
          function rand_color() {
            return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
          }
          //在body添加这个标签
          $("body").append($i);
          //animate() 方法执行 CSS 属性集的自定义动画。
          //该方法通过CSS样式将元素从一个状态改变为另一个状态。CSS属性值是逐渐改变的，这样就可以创建动画效果。
          //详情请看http://www.w3school.com.cn/jquery/effect_animate.asp
          $i.animate({
            //将原来的位置向上移动180
            "top": y - 180,
            "opacity": 0
            //1500动画的速度
          }, 1500, function () {
            //时间到了自动删除
            $i.remove();
          });
        });
      })
      ;
    </script>
  












<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
